'use strict';

var ProfileBody = React.createClass({
    displayName: 'ProfileBody',
    getInitialState: function getInitialState() {
        return {
            profile: this.props.profile,
            view: { showModal: false },
            reviews: [],
            reviewCount: 0,
            rating: 0,
            initials: ''
        };
    },
    openScoreDetails: function openScoreDetails() {
        //  $("#modalContent").html("<div>Score details...</div>");
        //  this.setState({view: {showModal: true}});
    },
    handleHideModal: function handleHideModal() {
        this.setState({ view: { showModal: false } });
    },
    componentWillMount: function componentWillMount() {
        console.log("ProfileBody:componentWillMount:");
        this.prepareComponentState(this.props);
    },
    componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
        console.log("ProfileBody:componentWillReceiveProps:");
        this.prepareComponentState(nextProps);
    },
    prepareComponentState: function prepareComponentState(props) {
        console.log("ProfileBody:prepareComponentState:");
        console.log(props);
        if (!$.isEmptyObject(props.profile) && $.isEmptyObject(this.state.profile)) {
            this.setState({
                profile: props.profile
            });
            console.log("ProfileBody:prepareComponentState:getInitials");
            // get initials
            var name = props.profile.firstName + ' ' + props.profile.lastName;
            console.log(name);
            if (name != null) {
                var initials = name.match(/\b\w/g);
                console.log(initials);
                initials = (initials.shift() + initials.pop()).toUpperCase();
                console.log(initials);
                this.setState({ initials: initials });
            }
        }
        // Get reviews
        if (this.state.reviews.length == 0) {
            var profileid = $("#profileid").val();
            if (profileid != "") {
                var data = {
                    id: profileid
                };
                var formData = JSON.stringify(data, null, ' ');
                console.log("Get Reviews:");
                console.log(formData);
                $.ajax({
                    type: "POST",
                    url: "/getReviewsForUser",
                    async: true,
                    data: formData,
                    success: (function (result) {
                        console.log(result);
                        if (result.page.totalElements > 0) {
                            this.setState({
                                reviews: result._embedded.reviewDTOList,
                                reviewCount: result.page.totalElements
                            });
                            this.calculateRating();
                            this.showReviews(result._embedded.reviewDTOList);
                        }
                    }).bind(this),
                    dataType: "json",
                    contentType: "application/json"
                });
            }
        }
    },
    calculateRating: function calculateRating() {
        console.log("Calculate rating");
        var total = this.state.reviewCount;
        var sum = 0;
        var reviews = this.state.reviews;
        console.log(reviews);
        $.each(reviews, function (key, value) {
            if (value.overallRating != null) {
                sum = sum + value.overallRating;
            }
        });
        var rating = sum / total;
        console.log(rating);
        this.setState({
            rating: rating
        });
    },
    whyCertified: function whyCertified() {
        bootbox.dialog({
            title: "Latch Certified Reviews",
            message: '<div class="bootbox-logo-middle"><img class="img-responsive" src="/images/LATCH-Logo-reviews.png" /></div><div class="text-left">LATCH Certified reviews are reviews that originated from a user on the LATCH platform. The review itself could have been manually triggered by the professional using the LATCH platform or automatically generated by the LATCH review engine itself. Reviews with this emblem are certified to be authentic and accurate.</div> '
        });
    },
    showReviews: function showReviews(review) {
        console.log("ProfileContent:ShowReviews:");
        console.log(review);
        var results = [];
        if (review.overallRating != null && review.reviewComments != "") {
            var created = new Date(review.completeTime);
            var createDate = $.datepicker.formatDate("mm/dd/yy", new Date(created));
            results.push(React.createElement(
                'li',
                { className: 'list-group-item', key: review.id },
                React.createElement(
                    'div',
                    { className: 'review-date' },
                    createDate
                ),
                React.createElement(
                    'div',
                    { className: 'review-badge' },
                    React.createElement(
                        'a',
                        { onClick: this.whyCertified, className: 'pointer' },
                        React.createElement('img', { src: '/images/LATCH-Logo-reviews.png', alt: 'Latch Certified' })
                    )
                ),
                React.createElement(
                    'div',
                    { className: 'review-stars' },
                    React.createElement(ReviewStars, { fontSize: '20px', rating: review.overallRating })
                ),
                React.createElement(
                    'div',
                    { className: 'review-summary' },
                    'Written by ',
                    React.createElement(
                        'a',
                        { className: 'reviewer-link', href: '/profile/' + review.reviewerUserId, target: '_blank' },
                        review.reviewer.firstName,
                        ' ',
                        review.reviewer.lastName
                    )
                ),
                React.createElement(
                    'div',
                    { className: 'review-description' },
                    review.reviewComments
                )
            ));
        }
        return results;
    },
    render: function render() {
        var leadParagraph = '';
        var description = '';
        if (this.state.profile.leadParagraph != null && this.state.profile.leadParagraph != "") {
            leadParagraph = this.state.profile.leadParagraph;
        }
        if (this.state.profile.description != null && this.state.profile.description != "") {
            description = this.state.profile.description;
        }
        var profileAvatar = React.createElement('img', { className: 'img-circle img-user', src: '/api/remoteFiles/view/' + this.state.profile.avatar });
        if (this.state.profile.avatar == 'default' && this.state.initials != '') {
            profileAvatar = React.createElement(
                'div',
                { className: 'avatar-circle-large' },
                React.createElement('img', { className: 'hidden', id: this.state.profile.id }),
                React.createElement(
                    'span',
                    { className: 'initials-large' },
                    this.state.initials
                )
            );
        }
        return React.createElement(
            'div',
            { className: 'row profile-row', id: 'home-content' },
            React.createElement(
                'div',
                { className: 'col-lg-12' },
                React.createElement(
                    'div',
                    { id: 'profile-content-row', className: 'row state-overview' },
                    React.createElement(
                        'div',
                        { className: 'row', id: 'profile-content' },
                        React.createElement(
                            'div',
                            { className: 'col-lg-12' },
                            React.createElement(
                                'div',
                                { className: 'panel panel-default' },
                                React.createElement(
                                    'div',
                                    { className: 'panel-heading' },
                                    React.createElement(
                                        'header',
                                        { className: 'panel-title' },
                                        React.createElement(
                                            'div',
                                            { className: 'profile-name' },
                                            React.createElement(
                                                'strong',
                                                null,
                                                this.state.profile.firstName
                                            ),
                                            ' ',
                                            this.state.profile.lastName,
                                            React.createElement(
                                                'strong',
                                                null,
                                                '.'
                                            )
                                        )
                                    )
                                ),
                                React.createElement(
                                    'div',
                                    { className: 'panel-body' },
                                    React.createElement(
                                        'div',
                                        { className: 'row' },
                                        React.createElement(
                                            'div',
                                            { className: 'col-md-12' },
                                            React.createElement(
                                                'div',
                                                { className: 'col-md-9' },
                                                React.createElement(
                                                    'div',
                                                    { className: 'col-md-4 text-center', id: 'user' },
                                                    profileAvatar,
                                                    React.createElement(
                                                        'p',
                                                        { className: 'sosmed-user' },
                                                        React.createElement(
                                                            'a',
                                                            { href: '#' },
                                                            React.createElement('i', { className: 'fa fa-facebook', onClick: this.openFacebook, 'data-toggle': 'tooltip', 'data-placement': 'top', title: 'Facebook' })
                                                        ),
                                                        React.createElement(
                                                            'a',
                                                            { href: '#' },
                                                            React.createElement('i', { className: 'fa fa-twitter', 'data-toggle': 'tooltip', 'data-placement': 'top', title: 'Twitter' })
                                                        ),
                                                        React.createElement(
                                                            'a',
                                                            { href: '#' },
                                                            React.createElement('i', { className: 'fa fa-google-plus', 'data-toggle': 'tooltip', 'data-placement': 'top', title: 'Google Plus' })
                                                        ),
                                                        React.createElement(
                                                            'a',
                                                            { href: '#' },
                                                            React.createElement('i', { className: 'fa fa-linkedin', 'data-toggle': 'tooltip', 'data-placement': 'top', title: 'Linkedin' })
                                                        )
                                                    )
                                                ),
                                                React.createElement(
                                                    'div',
                                                    { className: 'col-md-4' },
                                                    React.createElement(
                                                        'div',
                                                        { className: 'profile-stars' },
                                                        React.createElement(
                                                            'div',
                                                            { className: 'profile-review-stars' },
                                                            React.createElement(ReviewStars, { fontSize: '26px', rating: this.state.rating })
                                                        ),
                                                        React.createElement(
                                                            'div',
                                                            { className: 'profile-head-title' },
                                                            '(',
                                                            this.state.reviewCount,
                                                            ' reviews)'
                                                        )
                                                    ),
                                                    React.createElement(ProfileBits, { profile: this.state.profile })
                                                ),
                                                React.createElement(
                                                    'div',
                                                    { className: 'col-md-4' },
                                                    React.createElement(
                                                        'div',
                                                        { className: 'simple-map' },
                                                        React.createElement(MapView, { profile: this.state.profile, lat: this.state.profile.lat,
                                                            lng: this.state.profile.lng })
                                                    )
                                                )
                                            ),
                                            React.createElement(
                                                'div',
                                                { className: 'col-md-3 score-chart' },
                                                React.createElement(
                                                    'div',
                                                    { onClick: this.openScoreDetails, id: 'scoreChartDiv', className: 'canvas-score pointer' },
                                                    React.createElement(ScoreChart, { id: this.state.profile.id })
                                                ),
                                                React.createElement(
                                                    'div',
                                                    null,
                                                    React.createElement(
                                                        'p',
                                                        { className: 'score-label' },
                                                        React.createElement('img', { src: '/images/LATCH-Logo.png', className: 'Score-brandImg' }),
                                                        'Score'
                                                    )
                                                )
                                            )
                                        ),
                                        this.state.view.showModal ? React.createElement(
                                            RemoteModal,
                                            { title: 'Score details', size: '', handleHideModal: this.handleHideModal },
                                            React.createElement('div', { id: 'modalContent' })
                                        ) : null,
                                        React.createElement(
                                            'div',
                                            { className: 'col-lg-12 col-md-12 col-xs-12' },
                                            React.createElement(
                                                'div',
                                                { className: 'tab-pane fade active in text-left', id: 'description' },
                                                React.createElement(
                                                    'p',
                                                    { className: 'lead' },
                                                    leadParagraph
                                                ),
                                                React.createElement(
                                                    'p',
                                                    { className: 'mainText bottom10' },
                                                    React.createElement('span', { dangerouslySetInnerHTML: { __html: marked(description) } })
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                        ),
                        React.createElement(
                            'div',
                            { id: 'reviews-panel', className: 'col-lg-12 col-md-12 col-xs-12' },
                            React.createElement(
                                'div',
                                { className: 'panel' },
                                React.createElement(
                                    'div',
                                    { className: 'panel-body' },
                                    React.createElement(
                                        'ul',
                                        { classNamne: 'list-group' },
                                        this.state.reviews.map(this.showReviews)
                                    )
                                )
                            )
                        ),
                        React.createElement(
                            'div',
                            { className: 'col-lg-12 col-md-12 col-xs-12' },
                            React.createElement(
                                'div',
                                { className: 'panel' },
                                React.createElement(
                                    'div',
                                    { className: 'panel-body' },
                                    React.createElement(
                                        'ul',
                                        { id: 'myTab', className: 'nav nav-pills' },
                                        React.createElement(
                                            'li',
                                            { className: 'active' },
                                            React.createElement(
                                                'a',
                                                { href: '#linkedin', 'data-toggle': 'tab' },
                                                React.createElement('i', { className: 'fa fa-linkedin' }),
                                                React.createElement('br', null),
                                                React.createElement(
                                                    'div',
                                                    null,
                                                    'Linked In'
                                                )
                                            )
                                        ),
                                        React.createElement(
                                            'li',
                                            { className: '' },
                                            React.createElement(
                                                'a',
                                                { href: '#zillow', 'data-toggle': 'tab' },
                                                React.createElement('i', { className: 'fa icon-zillow' }),
                                                React.createElement('br', null),
                                                React.createElement(
                                                    'div',
                                                    null,
                                                    'Zillow'
                                                )
                                            )
                                        ),
                                        React.createElement(
                                            'li',
                                            { className: '' },
                                            React.createElement(
                                                'a',
                                                { href: '#facebook', 'data-toggle': 'tab' },
                                                React.createElement('i', { className: 'fa fa-facebook' }),
                                                React.createElement('br', null),
                                                React.createElement(
                                                    'div',
                                                    null,
                                                    'Facebook'
                                                )
                                            )
                                        ),
                                        React.createElement(
                                            'li',
                                            { className: '' },
                                            React.createElement(
                                                'a',
                                                { href: '#googleplus', 'data-toggle': 'tab' },
                                                React.createElement(
                                                    'i',
                                                    { className: 'fa fa-google-plus' },
                                                    React.createElement('br', null)
                                                ),
                                                React.createElement(
                                                    'div',
                                                    null,
                                                    'Google Plus'
                                                )
                                            )
                                        ),
                                        React.createElement(
                                            'li',
                                            { className: '' },
                                            React.createElement(
                                                'a',
                                                { href: '#instagram', 'data-toggle': 'tab' },
                                                React.createElement(
                                                    'i',
                                                    { className: 'fa fa-instagram' },
                                                    React.createElement('br', null)
                                                ),
                                                React.createElement(
                                                    'div',
                                                    null,
                                                    'Instagram'
                                                )
                                            )
                                        )
                                    ),
                                    React.createElement(
                                        'div',
                                        { id: 'myTabContent', className: 'tab-content' },
                                        React.createElement(
                                            'div',
                                            { className: 'tab-pane fade active in', id: 'linkedin' },
                                            React.createElement(LinkedIn, { profile: this.state.profile })
                                        ),
                                        React.createElement(
                                            'div',
                                            { className: 'tab-pane fade text-left', id: 'zillow' },
                                            React.createElement(Zillow, { profile: this.state.profile })
                                        ),
                                        React.createElement(
                                            'div',
                                            { className: 'tab-pane fade', id: 'facebook' },
                                            React.createElement(Facebook, { profile: this.state.profile })
                                        ),
                                        React.createElement(
                                            'div',
                                            { className: 'tab-pane fade', id: 'googleplus' },
                                            React.createElement(GooglePlus, { profile: this.state.profile })
                                        ),
                                        React.createElement(
                                            'div',
                                            { className: 'tab-pane fade', id: 'instagram' },
                                            React.createElement(Instagram, { profile: this.state.profile })
                                        )
                                    )
                                )
                            )
                        )
                    )
                )
            )
        );
    }
});